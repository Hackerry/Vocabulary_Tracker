package test

import (
	"testing"

	"github.com/Hackerry/Vocabulary_Tracker/api"
)

const verisimilitude = `[{"meta":{"id":"verisimilitude","uuid":"5c528eda-14fa-4e3e-858b-e42effbb4606","sort":"220057400","src":"collegiate","section":"alpha","stems":["verisimilitude","verisimilitudes","verisimilitudinous"],"offensive":false},"hwi":{"hw":"veri*si*mil*i*tude","prs":[{"mw":"\u02ccver-\u0259-s\u0259-\u02c8mi-l\u0259-\u02cct\u00fcd","sound":{"audio":"verisi02","ref":"c","stat":"1"}},{"mw":"-\u02ccty\u00fcd"}]},"fl":"noun","def":[{"sseq":[[["sense",{"sn":"1","dt":[["text","{bc}the quality or state of being {a_link|verisimilar}"]]}]],[["sense",{"sn":"2","dt":[["text","{bc}something verisimilar"]]}]]]}],"uros":[{"ure":"veri*si*mil*i*tu*di*nous","prs":[{"mw":"\u02ccver-\u0259-s\u0259-\u02ccmi-l\u0259-\u02c8t\u00fcd-n\u0259s","sound":{"audio":"verisi03","ref":"c","stat":"1"}},{"mw":"-\u02c8ty\u00fcd-","pun":";"},{"mw":"-\u02c8t\u00fc-d\u0259-n\u0259s"},{"mw":"-\u02c8ty\u00fc-"}],"fl":"adjective"}],"et":[["text","borrowed from Latin {it}v\u0113r\u012bsimilit\u016bd\u014d{\/it}, from {it}v\u0113r\u012b similis, v\u0113r\u012bsimilis{\/it} \u0022having the appearance of truth\u0022 + {it}-t\u016bd\u014d{\/it}, suffix of abstract nouns {ma}{mat|verisimilar|}{\/ma}"]],"date":"circa 1576{ds||1||}","shortdef":["the quality or state of being verisimilar","something verisimilar"]}]`
const some = `[{"meta":{"id":"some:1","uuid":"84fa91a1-6554-47ab-8f19-a3907f5af578","sort":"194584300","src":"collegiate","section":"alpha","stems":["some"],"offensive":false},"hom":1,"hwi":{"hw":"some","prs":[{"mw":"\u02c8s\u0259m","sound":{"audio":"some0001","ref":"c","stat":"1"}},{"l":"for sense 2 without stress"}]},"fl":"adjective","def":[{"sseq":[[["sense",{"sn":"1","dt":[["text","{bc}being an unknown, undetermined, or unspecified unit or thing "],["vis",[{"t":"{wi}some{\/wi} person knocked"}]]]}]],[["sense",{"sn":"2 a","dt":[["text","{bc}being one, a part, or an unspecified number of {a_link|something} (such as a class or group) named or implied "],["vis",[{"t":"{wi}some{\/wi} gems are hard"}]]]}],["sense",{"sn":"b","dt":[["text","{bc}being of an unspecified amount or number "],["vis",[{"t":"give me {wi}some{\/wi} water"},{"t":"have {wi}some{\/wi} apples"}]]]}]],[["sense",{"sn":"3","dt":[["text","{bc}{sx|remarkable||}, {sx|striking||} "],["vis",[{"t":"that was {wi}some{\/wi} party"}]]]}]],[["sense",{"sn":"4","dt":[["text","{bc}being at least one "],["uns",[[["text","used to indicate that a logical proposition is asserted only of a subclass or certain members of the class denoted by the term which it modifies"]]]]]}]]]}],"et":[["text","Middle English {it}som{\/it}, adjective \u0026 pronoun, from Old English {it}sum{\/it}; akin to Old High German {it}sum{\/it} some, Greek {it}ham\u0113{\/it} somehow, {it}homos{\/it} same {ma}{mat|same|}{\/ma}"]],"date":"before 12th century{ds||1||}","shortdef":["being an unknown, undetermined, or unspecified unit or thing","being one, a part, or an unspecified number of something (such as a class or group) named or implied","being of an unspecified amount or number"]},{"meta":{"id":"some:2","uuid":"3ada0640-8855-4d8d-a671-5580c5dfbf73","sort":"194584400","src":"collegiate","section":"alpha","stems":["some"],"offensive":false},"hom":2,"hwi":{"hw":"some","prs":[{"mw":"\u02c8s\u0259m","sound":{"audio":"some0001","ref":"c","stat":"1"}}]},"fl":"pronoun, singular or plural in construction","def":[{"sseq":[[["sense",{"sn":"1","dt":[["text","{bc}one indeterminate quantity, portion, or number as distinguished from the rest"]]}]],[["sense",{"sn":"2","dt":[["text","{bc}an indefinite additional amount "],["vis",[{"t":"ran a mile and then {wi}some{\/wi}"}]]]}]]]}],"date":"before 12th century{ds||1||}","shortdef":["one indeterminate quantity, portion, or number as distinguished from the rest","an indefinite additional amount"]},{"meta":{"id":"some:3","uuid":"569825c7-a0b6-4381-be4f-240ce7275c38","sort":"194584500","src":"collegiate","section":"alpha","stems":["some"],"offensive":false},"hom":3,"hwi":{"hw":"some","prs":[{"mw":"\u02c8s\u0259m","sound":{"audio":"some0001","ref":"c","stat":"1"}},{"mw":"\u02ccs\u0259m"}]},"fl":"adverb","def":[{"sseq":[[["sense",{"sn":"1","dt":[["text","{bc}{sx|about||} "],["vis",[{"t":"{wi}some{\/wi} 80 houses"},{"t":"twenty-{it}some{\/it} people"}]]]}]],[["sense",{"sn":"2 a","dt":[["text","{bc}in some degree {bc}{sx|somewhat||} "],["vis",[{"t":"felt {wi}some{\/wi} better"}]]]}],["sense",{"sn":"b","dt":[["text","{bc}to some degree or extent {bc}a little "],["vis",[{"t":"the cut bled {wi}some{\/wi}"},{"t":"I need to work on it {wi}some{\/wi} more"}]]]}],["sense",{"sn":"c","dt":[["uns",[[["text","used as a mild intensive "],["vis",[{"t":"that\u0027s going {wi}some{\/wi}"}]]]]]]}]]]}],"usages":[{"pl":"Using {parahw}some{\/parahw} as an Adverb","pt":[["text","When {it}some{\/it} is used to modify a number, it is almost always a round number "],["vis",[{"t":"a community of {it}some{\/it} 150,000 inhabitants"}]],["text"," but because {it}some{\/it} is slightly more emphatic than {it}about{\/it} or {it}approximately{\/it} it is occasionally used with a more exact number in an intensive function. "],["vis",[{"t":"an expert parachutist, he has {it}some{\/it} 115 jumps to his credit","aq":{"source":"{it}Current Biography{\/it}"}}]],["text"," When {it}some{\/it} is used without a number, most commentators feel that {it}somewhat{\/it} is to be preferred. Their advice is an oversimplification, however; only when {it}some{\/it} modifies an adjective, usually a comparative, will {it}somewhat{\/it} always substitute smoothly. When {it}some{\/it} modifies a verb or adverb, and especially when it follows a verb, substitution of {it}somewhat{\/it} may prove awkward. "],["vis",[{"t":"Italy forced me to grow up {it}some{\/it}","aq":{"auth":"E. W. Brooke"}},{"t":"I\u0027m not a prude; I\u0027ve been around {it}some{\/it} in my day","aq":{"auth":"Roy Rogers"}},{"t":"here in Newport, both Southern Cross and Courageous practiced {it}some{\/it} more","aq":{"auth":"W. N. Wallace"}}]]]}],"date":"before 12th century{ds||1||}","shortdef":["about","in some degree : somewhat","to some degree or extent : a little"]},{"meta":{"id":"-some:1","uuid":"5f026ba8-abfe-4f2b-8887-b8733ae7577e","sort":"194584600","src":"collegiate","section":"alpha","stems":["-some"],"offensive":false},"hom":1,"hwi":{"hw":"-some"},"fl":"adjective suffix","def":[{"sseq":[[["sense",{"dt":[["text","{bc}characterized by a (specified) thing, quality, state, or action "],["vis",[{"t":"awe{it}some{\/it}"},{"t":"burden{it}some{\/it}"},{"t":"cuddle{it}some{\/it}"}]]]}]]]}],"et":[["text","Middle English {it}-som{\/it}, from Old English {it}-sum{\/it}; akin to Old High German {it}-sam{\/it} -some, Old English {it}sum{\/it} some"]],"shortdef":["characterized by a (specified) thing, quality, state, or action"]},{"meta":{"id":"-some:2","uuid":"1d986e69-c9a7-44df-9bd5-07279616a75f","sort":"194584700","src":"collegiate","section":"alpha","stems":["-some","-somes"],"offensive":false},"hom":2,"hwi":{"hw":"-some"},"fl":"noun suffix","def":[{"sseq":[[["sense",{"dt":[["text","{bc}group of (so many) members and especially persons "],["vis",[{"t":"four{it}some{\/it}"}]]]}]]]}],"et":[["text","Middle English (northern dialect) {it}-sum{\/it}, from Middle English {it}sum{\/it}, pronoun, one, some"]],"shortdef":["group of (so many) members and especially persons"]},{"meta":{"id":"-some:3","uuid":"f17eaab5-7e25-48e2-b3a6-2533671ce2dc","sort":"194584800","src":"collegiate","section":"alpha","stems":["-some","-somes"],"offensive":false},"hom":3,"hwi":{"hw":"-some"},"fl":"noun combining form","def":[{"sseq":[[["sense",{"sn":"1","dt":[["text","{bc}body "],["vis",[{"t":"chromo{it}some{\/it}"}]]]}]],[["sense",{"sn":"2","dt":[["text","{bc}chromosome "],["vis",[{"t":"mono{it}some{\/it}"}]]]}]]]}],"et":[["text","New Latin {it}-somat-, -soma{\/it}, from Greek {it}s\u014dmat-, s\u014dma{\/it}"]],"shortdef":["body","chromosome"]},{"meta":{"id":"some distance","uuid":"a201c6c5-59c4-4ead-adc2-44a35e62c758","sort":"3018023000","src":"ld","section":"idioms","stems":["some distance"],"offensive":false},"hwi":{"hw":"some distance"},"fl":"idiom","def":[{"sseq":[[["sense",{"dt":[["text","{bc}not a short way "],["vis",[{"t":"The nearest gas station is {it}some distance{\/it} away."}]]]}]]]}],"shortdef":["not a short way"]},{"meta":{"id":"some kind\/sort\/type of","uuid":"4460d4b9-c83d-4515-a8f1-7ea027472852","sort":"3018025000","src":"ld","section":"idioms","stems":["some kind of","some kind\/sort\/type of","some sort of","some type of"],"offensive":false},"hwi":{"hw":"some kind\/sort\/type of"},"fl":"idiom","def":[{"sseq":[[["sense",{"dt":[["uns",[[["text","used to indicate that the speaker is referring to a range of items that could fit a description "],["vis",[{"t":"I need {it}some kind\/sort\/type of{\/it} fastener."}]]]]]]}]]]}],"shortdef":["\u2014used to indicate that the speaker is referring to a range of items that could fit a description"]},{"meta":{"id":"some other","uuid":"6c9dce0c-cac0-45d6-bf22-baed42532e7d","sort":"3018057000","src":"ld","section":"idioms","stems":["some other"],"offensive":false},"hwi":{"hw":"some other"},"fl":"idiom","def":[{"sseq":[[["sense",{"dt":[["text","{bc}a different {bc}another "],["vis",[{"t":"The main road is closed, so you\u0027ll need to find {it}some other{\/it} way to get there."}]]]}]]]}],"shortdef":["a different : another"]},{"meta":{"id":"some people\/guys have all the luck","uuid":"8bc12d22-b70a-4e0f-8f78-554e4ff452b7","sort":"3018058000","src":"ld","section":"idioms","stems":["some guys have all the luck","some people have all the luck","some people\/guys have all the luck"],"offensive":false},"hwi":{"hw":"some people\/guys have all the luck"},"fl":"idiom","def":[{"sseq":[[["sense",{"dt":[["text","{bc}some people are very lucky "],["vis",[{"t":"I can\u0027t believe they gave the job to that guy. {it}Some people\/guys have all the luck{\/it}."}]]]}]]]}],"shortdef":["some people are very lucky"]}]`
const volumious = `["volumises","voluminous","volumizes","voluminously","volumizers","nonluminous","volumes","calumnious","volumise","voluptuous","volumised","aluminous","volumize","luminous","volumized","voluming","volumizer","volutins","villainous","voluminousness"]`
const protect = `{"meta":{"status":200},"data":[{"slug":"守る","is_common":true,"tags":["wanikani16"],"jlpt":["jlpt-n3"],"japanese":[{"word":"守る","reading":"まもる"},{"word":"護る","reading":"まもる"},{"word":"戍る","reading":"まもる"}],"senses":[{"english_definitions":["to protect","to guard","to defend"],"parts_of_speech":["Godan verb with ru ending","Transitive verb"],"links":[],"tags":[],"restrictions":[],"see_also":[],"antonyms":[],"source":[],"info":[]},{"english_definitions":["to keep (i.e. a promise)","to abide (by the rules)","to observe","to obey","to follow"],"parts_of_speech":["Godan verb with ru ending","Transitive verb"],"links":[],"tags":[],"restrictions":[],"see_also":[],"antonyms":[],"source":[],"info":[]}],"attribution":{"jmdict":true,"jmnedict":false,"dbpedia":false}}]}`
const word = `{"meta":{"status":200},"data":[{"slug":"言葉","is_common":true,"tags":["wanikani12"],"jlpt":["jlpt-n5"],"japanese":[{"word":"言葉","reading":"ことば"},{"word":"詞","reading":"ことば"},{"word":"辞","reading":"ことば"},{"word":"言葉","reading":"けとば"}],"senses":[{"english_definitions":["language","dialect"],"parts_of_speech":["Noun"],"links":[],"tags":[],"restrictions":[],"see_also":["言語"],"antonyms":[],"source":[],"info":[]},{"english_definitions":["word","words","phrase","term","expression","remark"],"parts_of_speech":["Noun"],"links":[],"tags":[],"restrictions":[],"see_also":["単語"],"antonyms":[],"source":[],"info":[]},{"english_definitions":["speech","(manner of) speaking"],"parts_of_speech":["Noun"],"links":[],"tags":[],"restrictions":[],"see_also":[],"antonyms":[],"source":[],"info":[]},{"english_definitions":["learning to speak","language acquisition"],"parts_of_speech":["Noun"],"links":[],"tags":[],"restrictions":[],"see_also":[],"antonyms":[],"source":[],"info":[]},{"english_definitions":["Ci (poetry)"],"parts_of_speech":["Wikipedia definition"],"links":[{"text":"Read “Ci (poetry)” on English Wikipedia","url":"http://en.wikipedia.org/wiki/Ci_(poetry)?oldid=492971177"},{"text":"Read “詞” on Japanese Wikipedia","url":"http://ja.wikipedia.org/wiki/詞?oldid=42783998"}],"tags":[],"restrictions":[],"see_also":[],"antonyms":[],"source":[],"info":[],"sentences":[]}],"attribution":{"jmdict":true,"jmnedict":false,"dbpedia":"http://dbpedia.org/resource/Ci_(poetry)"}},{"slug":"辞典","is_common":true,"tags":["wanikani16"],"jlpt":["jlpt-n4"],"japanese":[{"word":"辞典","reading":"じてん"},{"word":"辭典","reading":"じてん"},{"word":"辞典","reading":"ことばてん"},{"word":"辭典","reading":"ことばてん"},{"word":"ことば典","reading":"ことばてん"},{"word":"言葉典","reading":"ことばてん"}],"senses":[{"english_definitions":["dictionary","lexicon"],"parts_of_speech":["Noun"],"links":[],"tags":[],"restrictions":[],"see_also":[],"antonyms":[],"source":[],"info":[]},{"english_definitions":["Dictionary"],"parts_of_speech":["Wikipedia definition"],"links":[{"text":"Read “Dictionary” on English Wikipedia","url":"http://en.wikipedia.org/wiki/Dictionary?oldid=495507120"},{"text":"Read “辞典” on Japanese Wikipedia","url":"http://ja.wikipedia.org/wiki/辞典?oldid=42126318"}],"tags":[],"restrictions":[],"see_also":[],"antonyms":[],"source":[],"info":[],"sentences":[]}],"attribution":{"jmdict":true,"jmnedict":false,"dbpedia":"http://dbpedia.org/resource/Dictionary"}},{"slug":"言葉遣い","is_common":true,"tags":["wanikani39"],"jlpt":["jlpt-n2"],"japanese":[{"word":"言葉遣い","reading":"ことばづかい"},{"word":"言葉使い","reading":"ことばづかい"},{"word":"言葉づかい","reading":"ことばづかい"}],"senses":[{"english_definitions":["speech","expression","wording","language"],"parts_of_speech":["Noun","Suru verb"],"links":[],"tags":[],"restrictions":[],"see_also":[],"antonyms":[],"source":[],"info":[]}],"attribution":{"jmdict":true,"jmnedict":false,"dbpedia":false}},{"slug":"言葉のあや","is_common":false,"tags":[],"jlpt":[],"japanese":[{"word":"言葉のあや","reading":"ことばのあや"},{"word":"言葉の綾","reading":"ことばのあや"}],"senses":[{"english_definitions":["figure of speech"],"parts_of_speech":["Noun"],"links":[],"tags":[],"restrictions":[],"see_also":[],"antonyms":[],"source":[],"info":[]}],"attribution":{"jmdict":true,"jmnedict":false,"dbpedia":false}},{"slug":"言葉数","is_common":false,"tags":[],"jlpt":[],"japanese":[{"word":"言葉数","reading":"ことばかず"}],"senses":[{"english_definitions":["number of words"],"parts_of_speech":["Noun"],"links":[],"tags":[],"restrictions":[],"see_also":[],"antonyms":[],"source":[],"info":[]},{"english_definitions":["vocality"],"parts_of_speech":["Noun"],"links":[],"tags":[],"restrictions":[],"see_also":[],"antonyms":[],"source":[],"info":[]}],"attribution":{"jmdict":true,"jmnedict":false,"dbpedia":false}},{"slug":"言葉通り","is_common":false,"tags":[],"jlpt":[],"japanese":[{"word":"言葉通り","reading":"ことばどおり"},{"word":"言葉どおり","reading":"ことばどおり"}],"senses":[{"english_definitions":["exactly as stated","verbatim"],"parts_of_speech":["Noun","No-adjective"],"links":[],"tags":[],"restrictions":[],"see_also":[],"antonyms":[],"source":[],"info":[]}],"attribution":{"jmdict":true,"jmnedict":false,"dbpedia":false}},{"slug":"言葉に詰まる","is_common":false,"tags":[],"jlpt":[],"japanese":[{"word":"言葉に詰まる","reading":"ことばにつまる"}],"senses":[{"english_definitions":["to be at a loss for words"],"parts_of_speech":["Expression","Godan verb with ru ending"],"links":[],"tags":[],"restrictions":[],"see_also":[],"antonyms":[],"source":[],"info":[]}],"attribution":{"jmdict":true,"jmnedict":false,"dbpedia":false}},{"slug":"言葉に窮する","is_common":false,"tags":[],"jlpt":[],"japanese":[{"word":"言葉に窮する","reading":"ことばにきゅうする"}],"senses":[{"english_definitions":["to be at a loss for words"],"parts_of_speech":["Expression","Suru verb - special class"],"links":[],"tags":[],"restrictions":[],"see_also":["言葉に詰まる"],"antonyms":[],"source":[],"info":[]}],"attribution":{"jmdict":true,"jmnedict":false,"dbpedia":false}},{"slug":"言葉を交わす","is_common":false,"tags":[],"jlpt":[],"japanese":[{"word":"言葉を交わす","reading":"ことばをかわす"}],"senses":[{"english_definitions":["to exchange words"],"parts_of_speech":["Expression","Godan verb with su ending"],"links":[],"tags":[],"restrictions":[],"see_also":["言葉を交える"],"antonyms":[],"source":[],"info":[]}],"attribution":{"jmdict":true,"jmnedict":false,"dbpedia":false}},{"slug":"言葉に甘える","is_common":false,"tags":[],"jlpt":[],"japanese":[{"word":"言葉に甘える","reading":"ことばにあまえる"},{"word":"ことばに甘える","reading":"ことばにあまえる"}],"senses":[{"english_definitions":["to accept a kind offer","to take someone up on their offer"],"parts_of_speech":["Expression","Ichidan verb"],"links":[],"tags":[],"restrictions":[],"see_also":[],"antonyms":[],"source":[],"info":["usu. as お言葉〜"]}],"attribution":{"jmdict":true,"jmnedict":false,"dbpedia":false}}]}`

func TestAPIURL(t *testing.T) {
	t.Logf("Test URL validity\n")

	helperURLTest("www.github.com", false, t)
	helperURLTest("www.github.com?word=" + api.WordPlaceHolder, true, t)
	helperURLTest("www.github.com?word=[]", false, t)
	helperURLTest("http://www.github.com?word=" + api.WordPlaceHolder, true, t)
	helperURLTest("https://www.github.com/Hackerry?word=" + api.WordPlaceHolder + "&key=12345", true, t)
	helperURLTest("https://www.dictionaryapi.com/api/v3/references/collegiate/json/" + api.WordPlaceHolder + "?key=1234", true, t)
}

func TestParseMW(t *testing.T) {
	t.Logf("Test parsing Merriam-Webster JSON\n")

	defs := api.ParseMWJson([]byte(verisimilitude))
	for i, def := range defs.DefList {
		t.Logf("Retrieved Entry %d: \n\n%v\n\n", i, def)
	}

	defs = api.ParseMWJson([]byte(some))
	for i, def := range defs.DefList {
		t.Logf("Retrieved Entry %d: \n\n%v\n\n", i, def)
	}

	defs = api.ParseMWJson([]byte(volumious))
	if !defs.SpellError {
		t.Fatalf("Should indicate spell error")
	}
	for i, def := range defs.DefList {
		t.Logf("Retrieved Entry %d: \n\n%v\n\n", i, def)
	}
}

func TestParseJS(t *testing.T) {
	t.Logf("Test parsing Jisho JSON\n")

	defs := api.ParseJSJson([]byte(protect))

	for i, def := range defs.DefList {
		t.Logf("Retrieved Entry %d: \n\n%v\n\n", i, def)
	}

	defs = api.ParseJSJson([]byte(word))
	for i, def := range defs.DefList {
		t.Logf("Retrieved Entry %d: \n\n%v\n\n", i, def)
	}
}

func helperURLTest(url string, expected bool, t *testing.T) {
	a := api.NewAPI(url, "Merriam-Webster")
	if (a != nil && !expected) {
		t.Fatalf("%s should be invalid\n", url)
	} else if (a == nil && expected) {
		t.Fatalf("%s should be valid\n", url)
	}

	if a != nil {
		t.Logf("Success: %s recorded as %s\n", url, a.Url)
	}
}